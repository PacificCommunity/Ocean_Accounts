---
title: "Generating Environmental Assets Accounts"
subtitle: "First Proof of Concept: ESA Land Use allocated Using Logistic Regression"
author: FAME Economics
date: "`r format(Sys.time(), '%d %B %Y')`"
output: 
   bookdown::word_document2:
      reference_docx: "C:\\From BigDisk\\GIT\\Ocean_Accounts\\Product_Output\\SPC_R_Template.docx"
      toc: false  
      fig_caption: true
      number_sections: true
      global_numbering: true  
---
\newpage


```{r setup, cache=FALSE, include=FALSE}

##
##    Core libraries
##
      library(ggplot2)
      library(plyr)
      library(stringr)
      library(lubridate)
      library(calibrate)
      library(Hmisc)
      library(RColorBrewer)
      library(stringi)
      library(sqldf)
      library(scales)
      library(RDCOMClient)
      library(extrafont)
      library(tictoc)
      library(RODBC)
      
      library(sysfonts)
      library(showtext)
##
##    Project-specific libraries
##
      library(knitr)
      library(citr)
      library(htmlTable)
      library(bookdown)
      library(kableExtra)
      library(pander)
      library(officer)


      library(RefManageR)

      BaseDir <- "C:\\From BigDisk\\GIT\\Ocean_Accounts\\Graphical_Output\\"

```

   

<!-- 
##
##       This bit below is the commentary written in R Markup
-->



# Background and context
The paper _Pacific Regional Environmental Accounts Incorporating Ocean Accounts_ (1 August 2025) outlined a strategy for developing Regional Environmental Asset Accounts using satelite-based remote sensing data. Building off Digital Earth Pacific (DEP) platform's data foundation, August's paper envisaged using DEP and FAME data to estimate Environmental Asset Accounts: 

```{r ClassificationofEnvironmentalAssets, echo=FALSE, fig.pos='h', out.width = '100%', fig.cap = "Classification of environmental assets in the SEEA Central Framework"}

knitr::include_graphics(paste0(BaseDir, "ClassificationofEnvironmentalAssets.png"))

```    

DEP products and Ocean Accounts live separate lives and have been on separate development trajectories. Not all of the spatial information needed for Enviromental Assets Accounts have been developed by DEP. DEP's focus is on developing applications: https://digitalearthpacific.org/#/applications for integration into its website front end: https://maps.digitalearthpacific.org/. Missing data sources for land assets, soil assets, and timber environmental assets have not yet been built within DEP, creating a "data hole" needing to be developed within Regional Environmental Asset Accounts project.

Analytical activity to date has focused on developing land use metrics from the European Space Agency (ESA) Climate Change Initiative (CCI) land use maps, sourced from here: https://www.esa-landcover-cci.org/, and tailored to pilot countries using Sentinel-2 data and statistical techniques. This approach has enabled ESA-derived land use measures to be grafted onto the prototype land areas, and land, timber and proxies for "soil" (agriculture and grassland) to be derived. 

Building prototype systems is about moving up a learning curve, continuously improving and refining. This project has followed this well-trodden. With the benefit of hindsight, changes would include:

_1. Moving away from PDH Pacific Coastline shape file, and adopting [DEP Coastlines](https://data.digitalearthpacific.org/#dep_ls_coastlines/) for defining the edges of countries_

   To simplify the analysis, both the ESA and Sentinel-2 data used in the prototype was truncated to [PDH Pacific Coastline](https://geonode.pacificdata.org/catalogue/#/dataset/1712). The truncation meant that when sampling the spatial data to form both a regression and test data set, only land-based information was used in the analysis. Without truncation, Pacific Island Countries and Territories (PICTs), surrounded by ocean would have a random sample over-represented by sea-based observations. 
   
   The effect of truncation to the Coastline shape file has been to omit areas which are in that "in-between" places between sea and land. Figure \@ref(fig:NoMangrove) illustrates how mangrove areas have been truncated from the data.

   ```{r echo=FALSE, fig.pos='h', out.width = '70%'}

   knitr::include_graphics(paste0(BaseDir, "Coastline_Shape.png"))


   ```

   ```{r NoMangrove, echo=FALSE, fig.pos='h', out.width = '70%', fig.cap = "Pacific Coastlines truncates in-between Land and Water Areas"}

   knitr::include_graphics(paste0(BaseDir, "Problem with Coastlines Shapefile.png"))

   ```

   [DEP Coastlines](https://data.digitalearthpacific.org/#dep_ls_coastlines/) (the yellow line) look better (Figure \@ref(fig:DEPCoast)).


   ```{r DEPCoast, echo=FALSE, fig.pos='h', out.width = '70%', fig.cap = "DEP Coastlines"}

   knitr::include_graphics(paste0(BaseDir, "DEP_Coastlines.png"))

   ```


_2. Adopting a more current ESA CCL data set._

   The ESA The land use data used in this analysis is "ESACCI-LC-L4-LCCS-Map-300m-P1Y-2015-v2.0.7.tif", a 300 meter by 300 meter resolution land use mapping created for the entire world, with data as at year end 2015 - currently 10 years out of date. More up-to-date data is available, but not as readily accessible as the 2015 data set. Version 2.1.1, is available on an annual basis from 2016 to 2020, and is definitionally consistent with version 2.0.7 used in this analysis and would be a better data source for future work.
   

_3. Adopt a stratified random sample for the regression and test data sets_

   Both the regression dataset, and the test dataset were derived through extracting two mutually exclusive simple random samples from the Sentinel-2 data matched to the its associated ESA land use value for the target prototype area.
   
   Table \@ref(tab:IPCCCatgories), in the [Appendix 1], describes all of the land uses available within ESA CCL dataset. Not all land values were available within the target prototype land area - the following land cover values were in the data:
      
   |Land Cover Value|	Description|
   |----------------|--------------|
   |10|	Rainfed cropland|
   |11|	Rainfed cropland|
   |12|	Rainfed cropland|
   |20|	Irrigated cropland|
   |30|	Mosaic cropland (>50%) / natural vegetation (tree, shrub,herbaceouscover) (<50%)|
   |40|	Mosaic natural vegetation (tree, shrub, herbaceous cover) (>50%) / cropland (< 50%)|
   |50|	Tree cover, broadleaved, evergreen, closed to open (>15%)|
   |80|	Tree cover, needleleaved, deciduous, closed to open (> 15%)|
   |100|	Mosaic tree and shrub (>50%) / herbaceous cover (< 50%)|
   |110|	Mosaic herbaceous cover (>50%) / tree and shrub (<50%)|
   |120|	Shrubland|
   |121|	Shrubland|
   |130|	Grassland|
   |150|	Sparse vegetation (tree, shrub, herbaceous cover)|
   |160|	Tree cover, flooded, fresh or brakish water|
   |170|	Tree cover, flooded, saline water|
   |190|	Urban|
   |210|	Water|


   Rather than a simple random sample, future work will explore drawing a stratified random sample with strata defined at both the country and the land cover level. A stratified sample draws a random sample from a population segregated by the stratum dimensions. If the data in the population contains unequal number of observations within the strata groupings, stratified sample ensures each different strata grouping contributes proportionally to the final analsys, regardless of its stratum size. 
   
   In the current prototype work, a 20\% simple random sample produced a regression data set which was heavily influences by land cover 50 - "Tree cover, broadleaved, evergreen, closed to open (>15%)"
   
   |Land Cover Value|Number of Observations|Proportion of Total|
   |:--------------:|:--------------------:|:-----------------:|   
   |10|	166,837|	2\%|
   |11|	141,786|	2\%|
   |12|	856|	0\%|
   |20|	5,261|	0\%|
   |30|	346,049|	4\%|
   |40|	675,169|	8\%|
   |50|	5,155,023|	58\%|
   |80|	332|	0\%|
   |100|	20,610|	0\%|
   |110|	29,109|	0\%|
   |120|	1,341,964|	15\%|
   |121|	497|	0\%|
   |130|	572|	0\%|
   |150|	383,695|	4\%|
   |160|	115,939|	1\%|
   |170|	237,013|	3\%|
   |190|	108,570|	1\%|
   |210|	188,308|	2\%|
   |Sample Totals|8,917,590|	100\%|
   
   While the simple random sample is unbiased - the population probably did contain 58\% tree cover - extending the analysis across a number of countries might not generate the same efficient sample. 
   
   Multiple countries of different sizes and land uses, will bias a sample towards land measures from the largest country, and the land uses which are most frequent across the countries. Stratifying the regression sampling by country and land use will ensure different countries and different size land use remain proportionally represented in the logistic regression.






incorporating DEP analysis into a suite of Environmental Asset Accounts for Pacific Island Countries and Territories (PICTs). Unfortunately, DEP-based land cover metrics are not sufficiently developed for analytical purpose.

Land use metrics were instead sourced from  ESA publichses a land use dashboard[https://maps.elie.ucl.ac.be/CCI/viewer/] which has a data download functionality. 

The land use data is for the year ending 2015 - currently 10 years out of date. More up-to-date data is available, but not as readily accessible as the 2015 data set. As a proof-of-concept it would suffice.


v2.0.7 - Global annual LC maps from 1992 to 2015 produced by the European Space Agency (ESA) Climate Change Initiative (CCI). These are the first years of the ESA CCI LC map series.

Copernicus data is freely available with login, and its web browser is well worth a visit: https://browser.dataspace.copernicus.eu/





\newpage

# Results




```{r echo=FALSE, fig.pos='h', out.width = '100%', fig.cap = "Experimental Land Use Metrics"}

knitr::include_graphics(paste0(BaseDir, "Experimental_Land_Area.png"))

```


```{r echo=FALSE, fig.pos='h', out.width = '100%', fig.cap = "Estimated Land Use - Sentinel-2 Data"}

knitr::include_graphics(paste0(BaseDir, "Estimated Land Use - Sentinel-2 Data - Version 2.png"))

```






\newpage

# Methodology
[^S2Bands]: Sentinel-2 collects four bands at 10 m, six bands at 20 m, and three bands at 60 m spatial resolution. https://dataspace.copernicus.eu/data-collections/copernicus-sentinel-data/sentinel-2

Estimating high resolution land use could happen through one or more possible measurement channels.

1. Small scale ground surveying of land use activity 
   The most intutitive approach to measuring land use is to directly measure land use activity in the location in question. For example, if the focus is an island, than coastline measures, and land activity could be estimated through direct measurement _in situ_. While simple, repeatable and accurate, the approach does not lend itself to scaling across geographical locations. The process involves collecting private data at substantial time and collection cost. As a repeatable process, it is not very repeatable. 


2. Satelite-based machine learning algorithms
   Satelite data is readily accessible in a variety of wavebands across the visible and non-visible spectrum. The (Sentinel-2 satelite constilation system)[https://www.esa.int/Applications/Observing_the_Earth/Copernicus/Sentinel-2] collects 10 meter by 10 meter resolution images across four spectral bands every 5 days.[^S2Bands]
   
   

   
   
   
   Machine-learning algorithms have been used to 


3. Statistical-based approaches





## Modelling low resolution land use to high resolution Sentinel-2 data

The 300 meter by 300 meter resolution ESA land use data, represented a consistently defined world measure, but was at a lower resolution than ideal. Specifically, Sentinel-2 data, which underpins DEP, operates at a 10 meter by 10 meter resolution across multple colour spectrums.
A logistic regression approach was used to estimate the high resolution land use measures associated with the 10 meter by 10 meter pixels underneath the 300 meter by 300 meter ESA measiures

, where the red / green / blue values from Sentinel-2 at the 10







\newpage

# Data Sources
Level 2A data are high quality data where the effects of the atmosphere on the light being reflected off of the surface of the Earth and reaching the sensor are excluded. Data are available globally since March 2017.


```{r echo=FALSE, fig.pos='h', out.width = '100%', fig.cap = "ESA Land Use Extract for Test Area"}

knitr::include_graphics(paste0(BaseDir, "ESA_Land_Use_Example.png"))

```

```{r echo=FALSE, fig.pos='h', out.width = '100%', fig.cap = "Sentinel-2 Colour Band"}

knitr::include_graphics(paste0(BaseDir, "Sentinel-2_Example.png"))

```



\newpage

# Issues


```{r echo=FALSE, fig.pos='h', out.width = '100%', fig.cap = "Vanua Levu as Shapefile"}

knitr::include_graphics(paste0(BaseDir, "Vanua_Levu_as_Shapefile.png"))

```

```{r echo=FALSE, fig.pos='h', out.width = '100%', fig.cap = "Vanua Levu in Google Maps"}

knitr::include_graphics(paste0(BaseDir, "Vanua_Levu_in_Google_Maps.png"))

```

```{r echo=FALSE, fig.pos='h', out.width = '100%', fig.cap = "Vanua Levu Missing Spatial Complexity"}

knitr::include_graphics(paste0(BaseDir, "Vanua_Levu_Missing_Spatial_Complexity.png"))

```


# Appendix 1



```{r RegressionSet, echo=FALSE, fig.pos='h', out.width = '100%', fig.cap = "Regression Dataset"}

knitr::include_graphics(paste0(BaseDir, "Regression_Dataset.png"))

```


```{r TestSet, echo=FALSE, fig.pos='h', out.width = '100%', fig.cap = "Test Dataset"}

knitr::include_graphics(paste0(BaseDir, "Test_Dataset.png"))

```



```{r IPCCCatgories, echo=FALSE, fig.pos='h'}

source("C:\\From BigDisk\\GIT\\Ocean_Accounts\\R\\functions.r")

names(IPCC_Land_Categories) <- str_replace_all(names(IPCC_Land_Categories), "_", " ")

knitr::kable(IPCC_Land_Categories, 
             booktabs = TRUE,
             caption = "Land Use Categories")

```






